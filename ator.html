<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página do Ator - {{ator.nome}}</title>
    <style>
        /* style.css - Estilos unificados do ator_style.css */

        /* ator_style.css - Estilos específicos para a página do ator (ator.html) - MELHORADO */

        .ator-page {
            text-align: left;
            padding: 30px;
            background-color: #181818; /* Fundo escuro consistente com index.html */
            color: #e0e0e0; /* Cor do texto consistente com index.html */
            font-family: 'Arial', sans-serif; /* Fonte consistente */
            display: flex;
            flex-direction: column;
            align-items: center; /* Centralizar conteúdo na página */
        }

        .ator-page h1 {
            font-size: 2.8em; /* Aumentei o tamanho do título principal */
            margin-bottom: 20px;
            text-align: center;
            color: #fff; /* Cor do título branco */
            text-shadow: 2px 2px 3px rgba(0,0,0,0.3); /* Sombra no texto do título */
        }

        .ator-detalhes {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            max-width: 1000px; /* Aumentei a largura máxima para mais espaço */
            margin: 20px auto; /* Centralizar e adicionar margem superior/inferior */
            padding: 25px; /* Aumentei o padding interno */
            background-color: #222; /* Fundo ligeiramente mais claro para o container de detalhes */
            border-radius: 10px; /* Bordas arredondadas */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); /* Sombra suave, consistente com index.html */
        }

        @media (max-width: 768px) { /* Media query para telas menores */
            .ator-detalhes {
                flex-direction: column; /* Empilhar foto e informações em telas menores */
                align-items: center; /* Centralizar os itens em coluna */
                padding: 20px; /* Ajustar padding para telas menores */
                gap: 20px; /* Ajustar gap para telas menores */
            }
            .ator-foto-e-nota {
                width: 100%; /* Foto ocupa largura total em telas menores */
                max-width: 300px; /* Limitar largura máxima da foto em telas menores */
            }
            .ator-foto-detalhe {
                max-width: 100%; /* Foto detalhada ocupa largura total do container em telas menores */
            }
        }


        .ator-foto-e-nota {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .ator-foto-detalhe {
            max-width: 300px;
            height: auto;
            border-radius: 10px;
            margin-bottom: 15px; /* Aumentei a margem inferior */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); /* Sombra mais pronunciada na foto */
        }

        .ator-nota-detalhe-container {
            text-align: center;
            margin-top: 10px; /* Aumentei a margem superior */
            padding: 10px 20px; /* Adicionei padding horizontal para destacar a nota */
            background-color: #333; /* Fundo para a nota */
            border-radius: 5px; /* Bordas arredondadas para a nota */
        }

        .ator-nota-detalhe-container p {
            font-size: 1.2em; /* Tamanho da fonte da nota */
            color: #fff; /* Cor da nota branca */
            margin: 0;
        }

        .ator-info-completa {
            flex: 1;
            padding-right: 15px; /* Adicionei padding direito para separar do texto */
        }

        .ator-info-completa p {
            font-size: 1.15em; /* Aumentei ligeiramente o tamanho da fonte do texto */
            line-height: 1.7; /* Aumentei o line-height para melhor legibilidade */
            margin-bottom: 15px; /* Aumentei a margem inferior dos parágrafos */
            color: #ddd; /* Cor do texto ligeiramente mais clara */
        }

        .ator-info-completa strong {
            color: #fff; /* Cor dos textos em negrito mais destacada */
            font-weight: bold; /* Garante que o texto em <strong> seja negrito */
        }

        /* Estilos para a secção "Atores Semelhantes" - MELHORADO */
        .atores-semelhantes-section {
            margin-top: 60px; /* Aumentei a margem superior para mais espaço */
            padding: 30px; /* Aumentei o padding interno */
            background-color: #222; /* Cor de fundo consistente com o container de detalhes */
            border-radius: 10px; /* Bordas arredondadas */
            text-align: center;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.4); /* Sombra ligeiramente mais suave */
        }

        .atores-semelhantes-section h2 {
            font-size: 2.3em; /* Aumentei o tamanho do título da seção */
            margin-bottom: 25px; /* Aumentei a margem inferior do título */
            color: #fff; /* Cor do título branco */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3); /* Sombra suave no título */
        }

        .atores-semelhantes-lista {
            display: grid; /* Usar grid para layout responsivo de atores semelhantes */
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); /* Cards menores e responsivos */
            gap: 20px; /* Espaçamento entre os cards */
            justify-content: center; /* Centralizar os cards horizontalmente */
        }

        .atores-semelhantes-lista .ator-card { /* Estilos específicos para cards na lista de semelhantes - MELHORADO */
            padding: 15px; /* Aumentei um pouco o padding interno */
            margin-bottom: 0; /* Removi a margem inferior */
            background-color: #333; /* Fundo dos cards consistente */
            border-radius: 8px; /* Bordas arredondadas */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* Sombra suave */
            transition: transform 0.3s ease; /* Transição suave hover */
        }

        .atores-semelhantes-lista .ator-card:hover {
            transform: scale(1.05); /* Efeito de zoom no hover */
        }

        .atores-semelhantes-lista .ator-card img.ator-foto { /* Imagem nos cards de semelhantes */
            border-radius: 8px 8px 0 0; /* Arredondar só em cima */
            aspect-ratio: 1/1; /* Manter proporção quadrada */
            object-fit: cover; /* Cobrir o espaço */
            width: 100%; /* Imagem responsiva */
            height: auto; /* Altura automática */
            display: block; /* Remover espaço extra abaixo da imagem */
        }


        .atores-semelhantes-lista h3 {
            font-size: 1.1em;
            margin-top: 10px; /* Adicionei margem superior */
            margin-bottom: 5px; /* Ajustei margem inferior */
            line-height: 1.3;
            color: #fff; /* Nome branco */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5); /* Sombra suave no nome */
        }

        .atores-semelhantes-lista h3 .percentagem-semelhanca { /* Estilo para a percentagem de semelhança - MELHORADO */
            font-size: 0.9em; /* Aumentei ligeiramente a percentagem */
            color: #aaa;
            display: block;
            margin-bottom: 5px; /* Ajustei margem inferior */
        }

        .atores-semelhantes-lista .ator-card p { /* Estilos para parágrafos DENTRO dos cards de semelhantes - MELHORADO */
            margin-bottom: 5px; /* Ajustei margem inferior */
            line-height: 1.3;
            font-size: 0.95em; /* Aumentei ligeiramente o tamanho da fonte */
            color: #ccc; /* Cor do texto ligeiramente mais clara */
        }


        /* Estilos para Tabelas - MELHORADO */
        .atores-tabela-container {
            overflow-x: auto;
            margin-bottom: 40px; /* Aumentei a margem inferior */
            margin-top: 40px; /* Aumentei a margem superior */
        }

        .atores-tabela {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px; /* Aumentei margem superior */
            color: white;
            border-radius: 8px; /* Bordas arredondadas na tabela */
            overflow: hidden; /* Garante que as bordas arredondadas funcionem */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3); /* Sombra suave na tabela */
        }

        .atores-tabela th, .atores-tabela td {
            border: none; /* Removi as bordas internas padrão */
            padding: 12px 10px; /* Aumentei o padding interno */
            text-align: left;
            border-bottom: 1px solid #555; /* Adicionei borda inferior mais suave */
        }

        .atores-tabela th {
            background-color: #444; /* Cor de fundo do cabeçalho da tabela */
            font-weight: bold;
            text-align: center;
            color: #eee; /* Cor do texto do cabeçalho */
        }

        /* Remover a última borda inferior da tabela */
        .atores-tabela tbody tr:last-child td {
            border-bottom: none;
        }


        #tabela-alturas-baixas-body th,
        #tabela-alturas-altas-body th {
            background-color: #555; /* Cor ligeiramente mais escura para sub-cabeçalhos */
            font-size: 1.1em;
            color: #fff; /* Cor do texto sub-cabeçalho branco */
        }


        /*  ator_style.css - Add these styles at the bottom of your file - MELHORADO */

        .filmes-videos-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* Cards ligeiramente maiores */
            gap: 25px; /* Aumentei o espaçamento */
            padding: 30px; /* Aumentei o padding */
            margin-top: 30px; /* Adicionei margem superior */
            background-color: #222; /* Cor de fundo consistente */
            border-radius: 10px; /* Bordas arredondadas */
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.4); /* Sombra suave */
        }

        .filme-video-card {
            background-color: #333; /* Cor de fundo dos cards consistente */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 7px rgba(0, 0, 0, 0.4); /* Sombra ligeiramente mais pronunciada */
            transition: transform 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
        }

        .filme-video-card:hover {
            transform: scale(1.04); /* Ligeiro aumento no hover */
        }

        .filme-video-imagem {
            width: 100%;
            height: 220px; /* Aumentei a altura da imagem */
            object-fit: cover;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }

        .filme-video-card h3 {
            font-size: 1.3em; /* Aumentei o tamanho do título */
            margin: 18px 15px 8px 15px; /* Ajustei as margens */
            color: white;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5); /* Sombra suave no título */
        }

        .filme-video-card p {
            font-size: 1.05em; /* Aumentei ligeiramente o tamanho do texto */
            margin: 0 15px 15px 15px; /* Ajustei as margens */
            color: #ddd;
            text-align: center;
        }

        .filme-video-card a {
            display: block;
            background-color: #444; /* Cor de fundo do botão ligeiramente mais clara */
            color: white;
            text-align: center;
            padding: 12px 15px; /* Aumentei o padding do botão */
            text-decoration: none;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            transition: background-color 0.3s ease; /* Transição suave no hover */
        }

        .filme-video-card a:hover {
            background-color: #555; /* Cor do botão no hover */
        }

        /* ator_style.css - Add these styles for "Ver Mais" buttons - MELHORADO */
        .ver-mais-btn {
            display: none; /* Hidden by default, shown by JS when needed */
            background-color: #444; /* Cor de fundo do botão ligeiramente mais clara */
            color: white;
            border: none;
            padding: 12px 20px; /* Aumentei o padding do botão */
            margin: 20px auto 30px auto; /* Ajustei as margens */
            border-radius: 8px; /* Bordas mais arredondadas */
            cursor: pointer;
            font-size: 1.05em; /* Aumentei ligeiramente o tamanho da fonte */
            transition: background-color 0.3s ease-in-out; /* Transição suave */
            width: fit-content;
            display: block;
            text-decoration: none;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); /* Sombra suave no botão */
        }

        .ver-mais-btn:hover {
            background-color: #555; /* Cor do botão no hover */
        }
    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

</head>
<body>
    <button onclick="window.location.href='index.html'" class="voltar-btn">⬅ Voltar à Página Principal</button>
    <div class="container ator-page">
        <h1 id="ator-nome-completo">{{ator.nome}}</h1>
        <div class="ator-detalhes">
            <div class="ator-foto-e-nota">
                <img id="ator-foto-detalhe" src="{{ator.foto}}" alt="{{ator.nome}}" class="ator-foto-detalhe">
                <p class="ator-nota-detalhe-container"><strong>Nota:</strong> <span id="ator-nota-detalhe">{{ator.nota}}/10</span></p>
            </div>
            <div class="ator-info-completa">
                <p><strong>Idade:</strong> <span id="ator-idade-detalhe">{{ator.idade}} anos</span></p>
                <p><strong>Data de Nascimento:</strong> <span id="ator-data-nascimento-detalhe">{{ator.dataNascimento}}</span></p>
                <p><strong>País:</strong> <span id="ator-pais-detalhe">
                    <a id="ator-pais-link" href="{{ator.nacionalidades.html}}" style="color: #eee; text-decoration: underline;">{{ator.pais}}</a>
                </span></p>
                <p><strong>Etnia:</strong> <span id="ator-etnia-detalhe">{{ator.etnia}}</span></p>
                <p><strong>Cor do Cabelo:</strong> <span id="ator-cor-cabelo-detalhe">{{ator.corCabelo}}</span></p>
                <p><strong>Cor dos Olhos:</strong> <span id="ator-cor-olhos-detalhe">{{ator.corOlhos}}</span></p>
                <p><strong>Altura:</strong> <span id="ator-altura-detalhe">{{ator.altura}} cm</span></p>
                <p><strong>Peso:</strong> <span id="ator-peso-detalhe">{{ator.peso}} kg</span></p>
                <p><strong>Tipo de Corpo:</strong> <span id="ator-tipo-corpo-detalhe">{{ator.tipoCorpo}}</span></p>
                <p><strong>Medidas:</strong> <span id="ator-medidas-detalhe">{{ator.medidas}}</span></p>
            </div>
        </div>

        <section id="conteudo-ator-section" class="conteudo-ator-section"> <!-- NOVA SECÇÃO "Conteúdo do Ator" -->
            <div class="conteudo-selector">
                <!-- Buttons removed in previous steps -->
            </div>

            <div id="filmes-container" class="conteudo-lista active">
                <h2 id="filmes-heading">Filmes de {{ator.nome}}</h2>  <!-- ADDED ID: filmes-heading -->
                <div id="filmes-lista" class="filmes-videos-container limited-list">
                    <p>Carregando filmes...</p>
                </div>
                <button id="ver-mais-filmes-btn" class="ver-mais-btn">Ver Mais Filmes</button>
            </div>

            <div id="videos-container" class="conteudo-lista">
                <h2 id="videos-cenas-heading">Vídeos e Cenas de {{ator.nome}}</h2> <!-- ADDED ID: videos-cenas-heading -->
                <div id="videos-lista" class="filmes-videos-container limited-list">
                     <p>Carregando vídeos e cenas...</p>
                </div>
                <button id="ver-mais-videos-btn" class="ver-mais-btn">Ver Mais Vídeos e Cenas</button>
            </div>
        </section>


        <section id="atores-semelhantes-section" class="atores-semelhantes-section">
            <h2>Atores Semelhantes</h2>
            <div id="atores-semelhantes-lista" class="atores-container">
                <!-- Atores semelhantes serão carregados aqui -->
                <p>Carregando atores semelhantes...</p>
            </div>
        </section>
    </div>

    <script type="module">
        // ator_script.js - Código Javascript unificado

        // **Importante: Substitua com suas configurações reais!**
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY", // **REPLACE WITH YOUR ACTUAL API KEY FROM FIREBASE!**
            authDomain: "babes-392fd.firebaseapp.com",
            projectId: "babes-392fd",
            storageBucket: "babes-392fd.appspot.com",
            messagingSenderId: "376795361631",
            appId: "1:376795361631:web:d662f2b2f2cd23b115c6ea",
            measurementId: "SEU_MEASUREMENT_ID" // OPCIONAL: Preencha se usar Google Analytics no Firebase
        };

        // Inicializar o Firebase
        firebase.initializeApp(firebaseConfig);

        // Inicializar o Firestore
        const db = firebase.firestore();

        let atoresGlobais = []; // Array global para armazenar todos os atores
        let atorIdGlobal; // Variável para guardar o ID do ator atual

        // State to track if "Ver Mais" has been clicked for each section
        let filmesVerMaisClicked = false;
        let videosVerMaisClicked = false;
        const initialLimit = 10; // Initial number of items to load

        document.addEventListener('DOMContentLoaded', () => {
            // Obter o ID do ator da URL
            const params = new URLSearchParams(window.location.search);
            const atorId = params.get('id');
            atorIdGlobal = atorId; // Guardar o ID do ator

            if (atorId) {
                carregarDetalhesAtor(atorId);
                carregarFilmesDoAtor(atorId, initialLimit); // Carregar filmes por default
                carregarVideosDoAtor(atorId, initialLimit); // Carregar vídeos e cenas por default
            } else {
                console.error("ID do ator não encontrado na URL.");
                alert("Erro: ID do ator não encontrado.");
            }

            // Event listeners para "Ver Mais" buttons
            document.getElementById('ver-mais-filmes-btn').addEventListener('click', () => {
                filmesVerMaisClicked = true;
                carregarFilmesDoAtor(atorId, null); // Load all films when "Ver Mais" is clicked
                document.getElementById('ver-mais-filmes-btn').style.display = 'none'; // Hide "Ver Mais" button after click
            });

            document.getElementById('ver-mais-videos-btn').addEventListener('click', () => {
                videosVerMaisClicked = true;
                carregarVideosDoAtor(atorId, null); // Load all videos when "Ver Mais" is clicked
                document.getElementById('ver-mais-videos-btn').style.display = 'none'; // Hide "Ver Mais" button after click
            });
        });

        async function carregarDetalhesAtor(atorId) {
            let atorPrincipal; // Declare atorPrincipal here
            try {
                const docSnapshot = await db.collection("atores").doc(atorId).get();
                if (docSnapshot.exists) {
                    atorPrincipal = docSnapshot.data();
                    console.log("carregarDetalhesAtor - atorPrincipal fetched:", atorPrincipal); // Debug log - after fetching
                    preencherPaginaAtor(atorPrincipal, atorId);
                    console.log("Detalhes do ator carregados com sucesso!");
                     carregarAtoresSemelhantes(atorPrincipal); // Carregar atores semelhantes APÓS carregar o ator principal
                } else {
                    console.error("Ator não encontrado no Firestore.");
                    alert("Ator não encontrado.");
                }
            } catch (error) {
                console.error("Erro ao carregar detalhes do ator: ", error);
                alert("Erro ao carregar detalhes do ator do Firebase. Veja a consola para mais detalhes.");
            }
            console.log("carregarDetalhesAtor - atorPrincipal before return:", atorPrincipal); // Debug log - before function return
            return atorPrincipal; // Return atorPrincipal for debugging purposes
        }

        function preencherPaginaAtor(ator, atorId) {
            document.getElementById("ator-nome-completo").textContent = ator.nome || "N/A";
            document.getElementById("ator-foto-detalhe").src = ator.foto || "URL_IMAGEM_PADRAO"; // **THIS LINE IS CRUCIAL**
            document.getElementById("ator-foto-detalhe").alt = ator.nome || "Ator sem nome";
            document.getElementById("ator-idade-detalhe").textContent = ator.idade || "N/A";
            document.getElementById("ator-data-nascimento-detalhe").textContent = ator.dataNascimento || "N/A";

            // Preencher o link da nacionalidade e o texto do span da nacionalidade
            const paisSpan = document.getElementById("ator-pais-detalhe");
            const paisLink = document.getElementById("ator-pais-link");
            if (paisSpan && paisLink) {
                paisLink.href = `nacionalidades.html?pais=${ator.pais || ''}`;
                paisLink.textContent = ator.pais || "N/A";
            } else {
                console.error("Elementos 'ator-pais-detalhe' ou 'ator-pais-link' não encontrados!");
            }


            document.getElementById("ator-etnia-detalhe").textContent = ator.etnia || "N/A";
            document.getElementById("ator-cor-cabelo-detalhe").textContent = ator.corCabelo || "N/A";
            document.getElementById("ator-cor-olhos-detalhe").textContent = ator.corOlhos || "N/A";
            document.getElementById("ator-altura-detalhe").textContent = ator.altura || "N/A";
            document.getElementById("ator-peso-detalhe").textContent = ator.peso || "N/A";
            document.getElementById("ator-tipo-corpo-detalhe").textContent = ator.tipoCorpo || "N/A";
            document.getElementById("ator-medidas-detalhe").textContent = ator.medidas || "N/A";
            document.getElementById("ator-nota-detalhe").textContent = ator.nota || "N/A";

            // **Update the headings with actor's name**
            document.getElementById('filmes-heading').textContent = `Filmes de ${ator.nome}`;
            document.getElementById('videos-cenas-heading').textContent = `Vídeos e Cenas de ${ator.nome}`;
        }

        async function carregarFilmesDoAtor(atorId, limit = null) {
            const filmesListaContainer = document.getElementById('filmes-lista');
            filmesListaContainer.innerHTML = "<p>Carregando filmes...</p>"; // Mensagem de carregamento

            let query = db.collection('filmes').where('atores', 'array-contains', atorId);
            if (limit && !filmesVerMaisClicked) { // Apply limit only on initial load and if "Ver Mais" is not clicked
                query = query.limit(limit);
            }

            try {
                const filmesSnapshot = await query.get();

                if (!filmesSnapshot.empty) {
                    const filmesDoAtor = filmesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    mostrarFilmesDoAtor(filmesListaContainer, filmesDoAtor);
                    // Show "Ver Mais" button if more items are available (simple check, might need adjustment for exact counts)
                    if (limit && filmesDoAtor.length > limit && !filmesVerMaisClicked) { // Basic check to show "Ver Mais" - adjust as needed
                        document.getElementById('ver-mais-filmes-btn').style.display = 'block';
                    } else {
                        document.getElementById('ver-mais-filmes-btn').style.display = 'none';
                    }
                } else {
                    filmesListaContainer.innerHTML = "<p>Este ator não participou em nenhum filme.</p>";
                    document.getElementById('ver-mais-filmes-btn').style.display = 'none'; // Hide button if no filmes
                }
            } catch (error) {
                console.error("Erro ao carregar filmes do ator: ", error);
                filmesListaContainer.innerHTML = "<p>Erro ao carregar filmes.</p>";
                document.getElementById('ver-mais-filmes-btn').style.display = 'none'; // Hide button on error
            }
        }

        function mostrarFilmesDoAtor(container, filmes) {
            container.innerHTML = ''; // Limpa a mensagem "Carregando filmes..."

            if (filmes.length === 0) {
                container.innerHTML = "<p>Este ator não participou em nenhum filme.</p>";
                return;
            }

            filmes.forEach(filme => {
                const filmeDiv = document.createElement('div');
                filmeDiv.className = 'filme-video-card';
                filmeDiv.innerHTML = `
                    <img src="${filme.imagem || 'URL_IMAGEM_PADRAO'}" alt="${filme.nome}" class="filme-video-imagem">
                    <h3>${filme.nome}</h3>
                    <p>Ano: ${filme.ano}</p>
                    <a href="${filme.pagina || '#'}" target="_blank">Ver Mais</a>
                `;
                container.appendChild(filmeDiv);
            });
        }


        async function carregarVideosDoAtor(atorId, limit = null) {
            const videosListaContainer = document.getElementById('videos-lista');
            videosListaContainer.innerHTML = "<p>Carregando vídeos e cenas...</p>";

            let query = db.collection('videos').where('atores', 'array-contains', atorId);
            let queryCenas = db.collection('cenas').where('atores', 'array-contains', atorId); // Query for cenas

            if (limit && !videosVerMaisClicked) { // Apply limit only on initial load and if "Ver Mais" is not clicked
                query = query.limit(limit);
                queryCenas = queryCenas.limit(limit); // Apply limit to cenas query as well
            }


            try {
                // Carregar Vídeos
                const videosSnapshot = await query.get();

                // Carregar Cenas
                const cenasSnapshot = await queryCenas.get();


                let videosDoAtor = videosSnapshot.docs.map(doc => ({ type: 'video', id: doc.id, ...doc.data() }));
                let cenasDoAtor = cenasSnapshot.docs.map(doc => ({ type: 'cena', id: doc.id, ...doc.data() }));

                const conteudoAtor = [...videosDoAtor, ...cenasDoAtor]; // Combina vídeos e cenas

                if (conteudoAtor.length > 0) {
                    mostrarVideosDoAtor(videosListaContainer, conteudoAtor);
                     // Show "Ver Mais" button if more items are available (simple check, might need adjustment for exact counts)
                    if (limit && conteudoAtor.length > limit && !videosVerMaisClicked) { // Basic check to show "Ver Mais" - adjust as needed
                        document.getElementById('ver-mais-videos-btn').style.display = 'block';
                    } else {
                        document.getElementById('ver-mais-videos-btn').style.display = 'none';
                    }
                } else {
                    videosListaContainer.innerHTML = "<p>Este ator não participou em vídeos ou cenas.</p>";
                    document.getElementById('ver-mais-videos-btn').style.display = 'none'; // Hide button if no videos
                }


            } catch (error) {
                console.error("Erro ao carregar vídeos e cenas do ator: ", error);
                videosListaContainer.innerHTML = "<p>Erro ao carregar vídeos e cenas.</p>";
                document.getElementById('ver-mais-videos-btn').style.display = 'none'; // Hide button on error
            }
        }


        function mostrarVideosDoAtor(container, conteudos) {
            container.innerHTML = '';
            if (conteudos.length === 0) {
                container.innerHTML = "<p>Este ator não participou em vídeos ou cenas.</p>";
                return;
            }

            conteudos.forEach(conteudo => {
                const conteudoDiv = document.createElement('div');
                conteudoDiv.className = 'filme-video-card';
                conteudoDiv.innerHTML = `
                    <img src="${conteudo.imagem || 'URL_IMAGEM_PADRAO'}" alt="${conteudo.nome}" class="filme-video-imagem">
                    <h3>${conteudo.nome} (${conteudo.type === 'video' ? 'Vídeo' : 'Cena'})</h3>
                    <p>Ano: ${conteudo.ano}</p>
                    <a href="${conteudo.pagina || '#'}" target="_blank">Ver Mais</a>
                `;
                container.appendChild(conteudoDiv);
            });
        }


        async function carregarAtoresSemelhantes(atorPrincipal) {
            console.log("carregarAtoresSemelhantes - atorPrincipal:", atorPrincipal); // Debug log - check atorPrincipal here!
            try {
                const snapshot = await db.collection("atores").get();
                atoresGlobais = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); // Carrega todos os atores para o array global

                const atoresSemelhantes = encontrarAtoresSemelhantes(atorPrincipal, atoresGlobais);
                mostrarAtoresSemelhantes(atoresSemelhantes);

            } catch (error) {
                console.error("Erro ao carregar atores semelhantes: ", error);
                alert("Erro ao carregar atores semelhantes.");
            }
        }

        function encontrarAtoresSemelhantes(atorPrincipal, todosAtores) {
            console.log("encontrarAtoresSemelhantes - atorPrincipal in function:", atorPrincipal); // Debug log - check atorPrincipal inside function

            // Capture atorPrincipal in a separate variable outside the filter for clarity
            const principalActor = atorPrincipal;

            return todosAtores.filter(ator => { // Using arrow function here
                // **PRIMEIRO: EXCLUIR O ATOR PRINCIPAL**
                console.log(`Comparando ator ID: ${ator.id} com atorPrincipal ID: ${principalActor?.id}`); // LOGGING! - use optional chaining
                if (ator.id === principalActor?.id) { // Use atorPrincipal directly within the arrow function
                    console.log(`Excluindo ator com ID: ${ator.id} por ser o ator principal.`); // LOGGING!
                    return false; // Exclui o próprio ator principal
                }

                let scoreSemelhanca = 0;

                // Critérios de semelhança com pesos (AJUSTE OS PESOS CONFORME NECESSÁRIO)
                if (ator.corCabelo === principalActor?.corCabelo) scoreSemelhanca += 20; // Use optional chaining
                if (ator.corOlhos === principalActor?.corOlhos) scoreSemelhanca += 15; // Use optional chaining
                if (ator.tipoCorpo === principalActor?.tipoCorpo) scoreSemelhanca += 25; // Use optional chaining
                if (ator.etnia === principalActor?.etnia) scoreSemelhanca += 10; // Use optional chaining

                // Critério de altura com range (Peso: 20%)
                const alturaPrincipal = parseInt(principalActor?.altura) || 0; // Use optional chaining
                const alturaAtor = parseInt(ator.altura) || 0;
                if (Math.abs(alturaAtor - alturaPrincipal) <= 5) scoreSemelhanca += 20; // Tolerância de 5cm

                // Critério de idade com range (Peso: 10%)
                const idadePrincipal = parseInt(principalActor?.idade) || 0; // Use optional chaining
                const idadeAtor = parseInt(ator.idade) || 0;
                if (Math.abs(idadeAtor - idadePrincipal) <= 5) scoreSemelhanca += 10;   // Tolerância de 5 anos


                // **ALTERAÇÃO IMPORTANTE: FILTRAR POR PERCENTAGEM DE SEMELHANÇA >= 75%**
                return scoreSemelhanca >= 75; // Considera semelhante SE A PONTUAÇÃO FOR 75% OU MAIOR
            })
            .map(ator => {
                // Calcular a percentagem de semelhança (PODE AJUSTAR O CÁLCULO CONFORME NECESSÁRIO)
                let percentagemSemelhanca = 0;
                if (ator.corCabelo === principalActor?.corCabelo) percentagemSemelhanca += 25; // Use optional chaining
                if (ator.tipoCorpo === principalActor?.tipoCorpo) percentagemSemelhanca += 25; // Use optional chaining
                if (ator.medidas === principalActor?.medidas) percentagemSemelhanca += 25; // Use optional chaining
                if (Math.abs(parseInt(ator.altura) - parseInt(principalActor?.altura)) <= 5) percentagemSemelhanca += 25; // Use optional chaining

                return { ...ator, percentagemSemelhanca: percentagemSemelhanca, id: ator.id }; // Retorna ator com percentagem e ID
            });
        }


        function mostrarAtoresSemelhantes(atoresSemelhantes) {
            const containerSemelhantes = document.getElementById("atores-semelhantes-lista");
            if (!containerSemelhantes) {
                console.error("Elemento 'atores-semelhantes-lista' não encontrado!");
                return;
            }
            containerSemelhantes.innerHTML = "";

            if (atoresSemelhantes.length === 0) {
                containerSemelhantes.innerHTML = "<p>Não foram encontrados atores semelhantes com 75% ou mais de semelhança.</p>";
                return;
            }

            atoresSemelhantes.forEach(atorSemelhante => {
                const cardLink = document.createElement("a");
                cardLink.href = `ator.html?id=${atorSemelhante.id}`;
                cardLink.style.textDecoration = 'none';

                const card = document.createElement("div");
                card.className = "ator-card";

                card.innerHTML = `
                    <img src="${atorSemelhante.foto}" alt="${atorSemelhante.nome}" class="ator-foto">
                    <h3>
                        ${atorSemelhante.nome}
                        <span class="percentagem-semelhanca">(${atorSemelhante.percentagemSemelhanca}% Semelhante)</span>
                    </h3>
                    <p>Nacionalidade: ${atorSemelhante.pais}</p>
                    <p>Idade: ${atorSemelhante.idade} anos</p>
                `;
                cardLink.appendChild(card);
                containerSemelhantes.appendChild(cardLink);
            });
        }


        // Função mostrarAtores (COPIE A FUNÇÃO mostrarAtores DO SEU script.js COMPLETO AQUI!)
        function mostrarAtores(containerId, atoresParaMostrar) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error(`Elemento '${containerId}' não encontrado na página!`);
                return;
            }
            container.innerHTML = "";

            atoresParaMostrar.forEach((ator, index) => {
                const cardLink = document.createElement("a");
                cardLink.href = `ator.html?id=${ator.id}`;
                cardLink.style.textDecoration = 'none';

                const card = document.createElement("div");
                card.className = "ator-card";

                card.innerHTML = `
                    <img src="${ator.foto}" alt="${ator.nome}" class="ator-foto">
                    <h3 class="ator-nome-card">${ator.nome}</h3>
                    <div class="ator-info-stack">
                        <p class="ator-nacionalidade-card">${ator.pais}</p>
                        <p class="ator-idade-card">${ator.idade} anos</p>
                    </div>
                `;

                cardLink.appendChild(card);
                container.appendChild(cardLink);
            });
        }
    </script>
</body>
</html>
